# Архитектура проекта

## Структура проекта

Проект разделен на 4 основных слоя:

### 1. **entities/** - Сущности (Модели данных)
Содержит классы данных без бизнес-логики:
- `Property`, `Apartment`, `House`, `CommercialProperty` - недвижимость
- `Client` - клиенты
- `Transaction` - сделки
- `Auction`, `Bid` - аукционы и ставки

**Ответственность:**
- Хранение данных
- Валидация данных на уровне сущности
- Сериализация через метод `toFileString()`
- Базовые операции сравнения и вывода

**Особенности:**
- Не содержат логики работы с файлами
- Не содержат бизнес-правил
- Используют наследование (Property → Apartment/House/CommercialProperty)

---

### 2. **services/** - Сервисы (Бизнес-логика)
Содержит менеджеры для управления коллекциями сущностей:

- **PropertyManager** - управление недвижимостью
- **ClientManager** - управление клиентами
- **TransactionManager** - управление сделками
- **AuctionManager** - управление аукционами
- **FileManager** - централизованная работа с файлами

**Ответственность:**
- Управление коллекциями сущностей (CRUD операции)
- Поиск и фильтрация данных
- Бизнес-правила и валидация на уровне менеджера
- **FileManager** - единственный класс, работающий с файлами

**Принципы:**
- Менеджеры НЕ содержат методов `saveToFile()` / `loadFromFile()`
- Менеджеры предоставляют методы `get*()` и `set*()` для доступа к данным
- FileManager использует эти методы для сохранения/загрузки
- Разделение ответственности: менеджеры управляют данными, FileManager - файлами

---

### 3. **ui/** - Пользовательский интерфейс
Содержит все Qt-компоненты интерфейса:

- `MainWindow` - главное окно приложения
- `*Widget` - виджеты для отображения данных (PropertiesWidget, ClientsWidget, etc.)
- `*Dialog` - диалоговые окна для редактирования (PropertyDialog, ClientDialog, etc.)
- `TableHelper` - утилиты для работы с QTableWidget

**Ответственность:**
- Отображение данных пользователю
- Обработка пользовательского ввода
- Визуальное оформление (стили, макеты)
- Взаимодействие с сервисами через EstateAgency
- Утилиты для работы с UI компонентами

**Принципы:**
- UI не содержит бизнес-логики
- UI обращается к данным только через менеджеры
- UI не работает напрямую с файлами

---

### 4. **core/** - Ядро системы
Содержит системные классы:

- `EstateAgency` - главный оркестратор (Singleton)
- `Constants` - константы приложения
- `Utils` - общие утилиты

**Ответственность:**
- Координация работы всех менеджеров
- Инициализация системы
- Централизованное сохранение/загрузка через FileManager
- Общие константы и утилиты

**Примечание:** `TableHelper` находится в `ui/`, так как зависит от Qt UI компонентов и используется только в UI-слое.

---

## Принципы архитектуры

### ✅ Разделение ответственности (Separation of Concerns)
- **Сущности** - только данные
- **Сервисы** - бизнес-логика
- **UI** - представление
- **Core** - координация

### ✅ Централизация файловых операций
- Все операции с файлами выполняются через `FileManager`
- Менеджеры не знают о файлах напрямую
- Единая точка входа для сохранения/загрузки

### ✅ Инкапсуляция
- Менеджеры предоставляют контролируемый доступ к данным
- FileManager использует публичные методы менеджеров
- UI работает только через публичный API

### ✅ Зависимости
```
UI → Core (EstateAgency) → Services → Entities
```

UI зависит от Core, Core зависит от Services, Services зависят от Entities.
Обратных зависимостей нет.

---

## Пример работы с данными

### Сохранение данных:
```
MainWindow → EstateAgency::saveAllData() 
          → FileManager::saveProperties(manager, filename)
          → manager.getProperties() 
          → entity.toFileString()
```

### Загрузка данных:
```
MainWindow → EstateAgency::loadAllData()
          → FileManager::loadProperties(manager, filename)
          → Парсинг файла → Создание сущностей
          → manager.setProperties(moved_properties)
```

---

## Преимущества такой архитектуры

1. **Легкость тестирования** - каждый слой можно тестировать отдельно
2. **Расширяемость** - легко добавить новые типы сущностей или менеджеров
3. **Поддерживаемость** - четкое разделение ответственности
4. **Переиспользование** - FileManager можно использовать для других форматов
5. **Гибкость** - легко изменить способ хранения (файлы → БД)



