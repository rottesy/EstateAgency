@startuml EstateAgency Class Diagram

!theme plain
skinparam classAttributeIconSize 0

' Core Domain Classes
abstract class Property {
  -id: string
  -city: string
  -street: string
  -house: string
  -price: double
  -area: double
  -description: string
  -isAvailable: bool
  +getId(): string
  +getCity(): string
  +getStreet(): string
  +getHouse(): string
  +getAddress(): string
  +getPrice(): double
  +getArea(): double
  +getDescription(): string
  +getIsAvailable(): bool
  +setPrice(double)
  +setArea(double)
  +setAddress(string, string, string)
  +setDescription(string)
  +setAvailable(bool)
  +{abstract} getType(): string
  +{abstract} displayInfo(): void
  +{abstract} toFileString(): string
  +{abstract} clone(): Property*
  +{static} validatePrice(double): bool
  +{static} validateArea(double): bool
  +{static} validateId(string): bool
  +{static} validateAddressPart(string): bool
}

class Apartment {
  -rooms: int
  -floor: int
  -hasBalcony: bool
  -hasElevator: bool
  +getRooms(): int
  +getFloor(): int
  +getHasBalcony(): bool
  +getHasElevator(): bool
  +setRooms(int)
  +setFloor(int)
  +getType(): string
  +displayInfo(): void
  +toFileString(): string
  +clone(): Property*
}

class House {
  -floors: int
  -rooms: int
  -landArea: double
  -hasGarage: bool
  -hasGarden: bool
  +getFloors(): int
  +getRooms(): int
  +getLandArea(): double
  +getHasGarage(): bool
  +getHasGarden(): bool
  +setFloors(int)
  +setRooms(int)
  +setLandArea(double)
  +getType(): string
  +displayInfo(): void
  +toFileString(): string
  +clone(): Property*
}

class CommercialProperty {
  -businessType: string
  -hasParking: bool
  -parkingSpaces: int
  -isVisibleFromStreet: bool
  +getBusinessType(): string
  +getHasParking(): bool
  +getParkingSpaces(): int
  +getIsVisibleFromStreet(): bool
  +setBusinessType(string)
  +setParkingSpaces(int)
  +getType(): string
  +displayInfo(): void
  +toFileString(): string
  +clone(): Property*
}

class Client {
  -id: string
  -name: string
  -phone: string
  -email: string
  -registrationDate: string
  +getId(): string
  +getName(): string
  +getPhone(): string
  +getEmail(): string
  +getRegistrationDate(): string
  +setName(string)
  +setPhone(string)
  +setEmail(string)
  +toString(): string
  +{static} validateId(string): bool
  +{static} validatePhone(string): bool
  +{static} validateEmail(string): bool
}

class Transaction {
  -id: string
  -propertyId: string
  -clientId: string
  -date: string
  -finalPrice: double
  -status: string
  -notes: string
  +getId(): string
  +getPropertyId(): string
  +getClientId(): string
  +getDate(): string
  +getFinalPrice(): double
  +getStatus(): string
  +getNotes(): string
  +setStatus(string)
  +setFinalPrice(double)
  +setNotes(string)
  +toString(): string
  +toFileString(): string
  +{static} validateId(string): bool
}

class Auction {
  -id: string
  -propertyId: string
  -propertyAddress: string
  -startingPrice: double
  -buyoutPrice: double
  -bids: vector<shared_ptr<Bid>>
  -status: string
  -createdAt: string
  -completedAt: string
  +getId(): string
  +getPropertyId(): string
  +getPropertyAddress(): string
  +getStartingPrice(): double
  +getBuyoutPrice(): double
  +getBids(): vector<shared_ptr<Bid>>
  +getStatus(): string
  +getCreatedAt(): string
  +getCompletedAt(): string
  +isActive(): bool
  +isCompleted(): bool
  +addBid(shared_ptr<Bid>): bool
  +addBidDirect(shared_ptr<Bid>): void
  +getCurrentHighestBid(): double
  +getHighestBid(): Bid*
  +complete(): void
  +cancel(): void
  +wasBuyout(): bool
  +toString(): string
  +toFileString(): string
}

class Bid {
  -clientId: string
  -clientName: string
  -amount: double
  -timestamp: string
  +getClientId(): string
  +getClientName(): string
  +getAmount(): double
  +getTimestamp(): string
  +toString(): string
  +toFileString(): string
}

' Manager Classes
class PropertyManager {
  -properties: vector<unique_ptr<Property>>
  -dataFilePath: string
  +addProperty(unique_ptr<Property>): void
  +addApartment(...): void
  +addHouse(...): void
  +addCommercialProperty(...): void
  +removeProperty(string): bool
  +findProperty(string): Property*
  +getAllProperties(): vector<Property*>
  +getAvailableProperties(): vector<Property*>
  +searchByPriceRange(double, double): vector<Property*>
  +searchByAddress(string, string, string): vector<Property*>
  +saveToFile(string): void
  +loadFromFile(string): void
  +getCount(): size_t
}

class ClientManager {
  -clients: vector<shared_ptr<Client>>
  -dataFilePath: string
  +addClient(shared_ptr<Client>): void
  +removeClient(string): bool
  +findClient(string): Client*
  +getAllClients(): vector<Client*>
  +searchByName(string): vector<Client*>
  +searchByPhone(string): vector<Client*>
  +saveToFile(string): void
  +loadFromFile(string): void
  +getCount(): size_t
}

class TransactionManager {
  -transactions: vector<shared_ptr<Transaction>>
  -dataFilePath: string
  +addTransaction(shared_ptr<Transaction>): void
  +removeTransaction(string): bool
  +findTransaction(string): Transaction*
  +getAllTransactions(): vector<Transaction*>
  +getTransactionsByClient(string): vector<Transaction*>
  +getTransactionsByProperty(string): vector<Transaction*>
  +getTransactionsByStatus(string): vector<Transaction*>
  +saveToFile(string): void
  +loadFromFile(string): void
  +getCount(): size_t
}

class AuctionManager {
  -auctions: vector<shared_ptr<Auction>>
  -dataFilePath: string
  +addAuction(shared_ptr<Auction>): void
  +removeAuction(string): bool
  +findAuction(string): Auction*
  +getAllAuctions(): vector<Auction*>
  +getActiveAuctions(): vector<Auction*>
  +getCompletedAuctions(): vector<Auction*>
  +getAuctionsByProperty(string): vector<Auction*>
  +saveToFile(string): void
  +loadFromFile(string): void
  +getCount(): size_t
}

' Exception Classes
class PropertyManagerException {
  -message: string
  +what(): const char*
}

class ClientManagerException {
  -message: string
  +what(): const char*
}

class TransactionManagerException {
  -message: string
  +what(): const char*
}

class AuctionManagerException {
  -message: string
  +what(): const char*
}

' Template Class
class ContainerManager<T> {
  #items: vector<shared_ptr<T>>
  +add(shared_ptr<T>): void
  +remove(string): void
  +findById(string): shared_ptr<T>
  +size(): size_t
  +begin(): const_iterator
  +end(): const_iterator
}

' Singleton Class
class EstateAgency {
  -{static} instance: EstateAgency*
  -propertyManager: PropertyManager
  -clientManager: ClientManager
  -transactionManager: TransactionManager
  -auctionManager: AuctionManager
  -dataDirectory: string
  -EstateAgency()
  +{static} getInstance(): EstateAgency*
  +{static} destroyInstance(): void
  +getPropertyManager(): PropertyManager&
  +getClientManager(): ClientManager&
  +getTransactionManager(): TransactionManager&
  +getAuctionManager(): AuctionManager&
  +saveAllData(): void
  +loadAllData(): void
  +setDataDirectory(string): void
  +getDataDirectory(): string
}

' UI Classes
class MainWindow {
  -agency: EstateAgency*
  -navigationList: QListWidget*
  -contentStack: QStackedWidget*
  -dashboardWidget: DashboardWidget*
  -propertiesWidget: PropertiesWidget*
  -clientsWidget: ClientsWidget*
  -transactionsWidget: TransactionsWidget*
  -auctionsWidget: AuctionsWidget*
  +MainWindow(QWidget*)
  -setupUI(): void
  -setupMenuBar(): void
  -setupNewUI(): void
  -applyStyles(): void
  -updateDashboardStats(): void
  -showStatusMessage(QString, int): void
}

class PropertyDialog {
  -typeCombo: QComboBox*
  -idEdit: QLineEdit*
  -cityEdit: QLineEdit*
  -streetEdit: QLineEdit*
  -houseEdit: QLineEdit*
  -priceSpin: QDoubleSpinBox*
  -areaSpin: QDoubleSpinBox*
  -descriptionEdit: QTextEdit*
  -availableCheck: QCheckBox*
  +PropertyDialog(QWidget*, Property*)
  +getPropertyType(): PropertyType
  +getId(): QString
  +getCity(): QString
  +getStreet(): QString
  +getHouse(): QString
  +getPrice(): double
  +getArea(): double
  +getDescription(): QString
  +getIsAvailable(): bool
}

class ClientDialog {
  -idEdit: QLineEdit*
  -nameEdit: QLineEdit*
  -phoneEdit: QLineEdit*
  -emailEdit: QLineEdit*
  -buttonBox: QDialogButtonBox*
  +ClientDialog(QWidget*, Client*)
  +getId(): QString
  +getName(): QString
  +getPhone(): QString
  +getEmail(): QString
}

class TransactionDialog {
  -idEdit: QLineEdit*
  -propertyCombo: QComboBox*
  -clientCombo: QComboBox*
  -priceSpin: QDoubleSpinBox*
  -statusCombo: QComboBox*
  -notesEdit: QTextEdit*
  -propertyPriceLabel: QLabel*
  -differenceLabel: QLabel*
  +TransactionDialog(QWidget*, Transaction*, QStringList, QStringList)
  +getId(): QString
  +getPropertyId(): QString
  +getClientId(): QString
  +getFinalPrice(): double
  +getStatus(): QString
  +getNotes(): QString
}

class AuctionDialog {
  -isViewMode: bool
  -currentAuction: Auction*
  -agency: EstateAgency*
  -idEdit: QLineEdit*
  -propertyCombo: QComboBox*
  -priceSpin: QDoubleSpinBox*
  -bidsTable: QTableWidget*
  -addBidBtn: QPushButton*
  -completeAuctionBtn: QPushButton*
  +AuctionDialog(QWidget*, Auction*, QStringList)
  +getId(): QString
  +getPropertyId(): QString
  +getStartingPrice(): double
  +refreshBids(): void
  +updateAuctionInfo(): void
}

class PropertiesWidget {
  -agency: EstateAgency*
  -propertiesTable: QTableWidget*
  -addPropertyBtn: QPushButton*
  -refreshPropertyBtn: QPushButton*
  -searchPropertyEdit: QLineEdit*
  -propertyDetailsText: QTextEdit*
  +PropertiesWidget(EstateAgency*, QWidget*)
  +refresh(): void
  +updateTable(): void
}

class ClientsWidget {
  -agency: EstateAgency*
  -clientsTable: QTableWidget*
  -addClientBtn: QPushButton*
  -refreshClientBtn: QPushButton*
  -searchClientEdit: QLineEdit*
  -clientDetailsText: QTextEdit*
  +ClientsWidget(EstateAgency*, QWidget*)
  +refresh(): void
  +updateTable(): void
}

class TransactionsWidget {
  -agency: EstateAgency*
  -transactionsTable: QTableWidget*
  -addTransactionBtn: QPushButton*
  -refreshTransactionBtn: QPushButton*
  -searchTransactionEdit: QLineEdit*
  -transactionDetailsText: QTextEdit*
  +TransactionsWidget(EstateAgency*, QWidget*)
  +refresh(): void
  +updateTable(): void
}

class AuctionsWidget {
  -agency: EstateAgency*
  -auctionsTable: QTableWidget*
  -addAuctionBtn: QPushButton*
  -refreshAuctionBtn: QPushButton*
  -searchAuctionEdit: QLineEdit*
  -auctionDetailsText: QTextEdit*
  +AuctionsWidget(EstateAgency*, QWidget*)
  +refresh(): void
  +updateTable(): void
}

class DashboardWidget {
  -agency: EstateAgency*
  -statsPropertiesLabel: QLabel*
  -statsClientsLabel: QLabel*
  -statsTransactionsLabel: QLabel*
  -statsAvailableLabel: QLabel*
  -statsAuctionsLabel: QLabel*
  +DashboardWidget(EstateAgency*, QWidget*)
  +updateStats(): void
}

' Inheritance Relationships
Property <|-- Apartment
Property <|-- House
Property <|-- CommercialProperty

' Composition/Aggregation Relationships
Auction "1" *-- "0..*" Bid : contains
Auction ..> Property : references (by id)
Transaction ..> Property : references (by id)
Transaction ..> Client : references (by id)
Bid ..> Client : references (by id)

PropertyManager "1" *-- "0..*" Property : manages
ClientManager "1" *-- "0..*" Client : manages
TransactionManager "1" *-- "0..*" Transaction : manages
AuctionManager "1" *-- "0..*" Auction : manages

EstateAgency "1" *-- "1" PropertyManager : contains
EstateAgency "1" *-- "1" ClientManager : contains
EstateAgency "1" *-- "1" TransactionManager : contains
EstateAgency "1" *-- "1" AuctionManager : contains

MainWindow "1" *-- "1" DashboardWidget : contains
MainWindow "1" *-- "1" PropertiesWidget : contains
MainWindow "1" *-- "1" ClientsWidget : contains
MainWindow "1" *-- "1" TransactionsWidget : contains
MainWindow "1" *-- "1" AuctionsWidget : contains

' Reference Relationships
MainWindow ..> EstateAgency : uses
PropertiesWidget ..> EstateAgency : uses
ClientsWidget ..> EstateAgency : uses
TransactionsWidget ..> EstateAgency : uses
AuctionsWidget ..> EstateAgency : uses
DashboardWidget ..> EstateAgency : uses
AuctionDialog ..> EstateAgency : uses
TransactionDialog ..> EstateAgency : uses

PropertyDialog ..> Property : edits
ClientDialog ..> Client : edits
TransactionDialog ..> Transaction : edits
AuctionDialog ..> Auction : edits

' Exception Relationships
PropertyManager ..> PropertyManagerException : throws
ClientManager ..> ClientManagerException : throws
TransactionManager ..> TransactionManagerException : throws
AuctionManager ..> AuctionManagerException : throws

' Note about namespaces
note right of TableHelper
  namespace TableHelper
  Utility functions for QTableWidget
end note

note right of Utils
  namespace Utils
  String conversion utilities
end note

note right of Constants
  namespace Constants
  Application constants
end note

@enduml


