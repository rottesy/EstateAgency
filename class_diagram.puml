@startuml course-work
scale 1.2
left to right direction

skinparam monochrome true
skinparam shadowing false
skinparam backgroundColor white
skinparam defaultFontColor black

skinparam ranksep 0.9
skinparam nodesep 0.8
skinparam linetype ortho

hide empty members
hide circle
hide stereotype
skinparam classAttributeIconSize 0
skinparam classVisibilityIconSize 0

skinparam class {
    AttributeFontSize 9
    FontSize 10
    Padding 6
    BackgroundColor white
    BorderColor black
    ArrowColor black
    BorderThickness 1
}
skinparam defaultFontSize 10

' 1. Structures (4 structures)
struct PropertyBaseParams {
  +id: string
  +city: string
  +street: string
  +house: string
  +price: double
  +area: double
  +description: string
}

struct ApartmentParams {
  +base: PropertyBaseParams
  +rooms: int
  +floor: int
  +hasBalcony: bool
  +hasElevator: bool
}

struct HouseParams {
  +base: PropertyBaseParams
  +floors: int
  +rooms: int
  +landArea: double
  +hasGarage: bool
  +hasGarden: bool
}

struct CommercialPropertyParams {
  +base: PropertyBaseParams
  +businessType: string
  +hasParking: bool
  +parkingSpaces: int
  +isVisibleFromStreet: bool
}

' 2. Abstract Property and implementations (4 classes)
abstract class Property {
  -id: string
  -city: string
  -street: string
  -house: string
  -price: double
  -area: double
  -description: string
  -isAvailable: bool
  +getId(): string
  +getCity(): string
  +getAddress(): string
  +getPrice(): double
  +getArea(): double
  +{abstract} getType(): string
  +{abstract} displayInfo(): void
  +{abstract} toFileString(): string
  +{abstract} clone(): Property*
  +{static} validatePrice(double): bool
  +{static} validateArea(double): bool
  +{static} validateId(string): bool
  +{static} validateAddressPart(string): bool
}

class Apartment {
  -rooms: int
  -floor: int
  -hasBalcony: bool
  -hasElevator: bool
  +getRooms(): int
  +getFloor(): int
  +getType(): string
  +displayInfo(): void
  +toFileString(): string
  +clone(): Property*
}

class House {
  -floors: int
  -rooms: int
  -landArea: double
  -hasGarage: bool
  -hasGarden: bool
  +getFloors(): int
  +getRooms(): int
  +getLandArea(): double
  +getType(): string
  +displayInfo(): void
  +toFileString(): string
  +clone(): Property*
}

class CommercialProperty {
  -businessType: string
  -hasParking: bool
  -parkingSpaces: int
  -isVisibleFromStreet: bool
  +getBusinessType(): string
  +getHasParking(): bool
  +getType(): string
  +displayInfo(): void
  +toFileString(): string
  +clone(): Property*
}

' 3. Core entities (4 classes)
class Client {
  -id: string
  -name: string
  -phone: string
  -email: string
  -registrationDate: string
  +getId(): string
  +getName(): string
  +getPhone(): string
  +getEmail(): string
  +toString(): string
  +{static} validateId(string): bool
  +{static} validatePhone(string): bool
  +{static} validateEmail(string): bool
}

class Transaction {
  -id: string
  -propertyId: string
  -clientId: string
  -date: string
  -finalPrice: double
  -status: string
  -notes: string
  +getId(): string
  +getPropertyId(): string
  +getClientId(): string
  +getFinalPrice(): double
  +getStatus(): string
  +toString(): string
  +toFileString(): string
  +{static} validateId(string): bool
}

class Auction {
  -id: string
  -propertyId: string
  -propertyAddress: string
  -startingPrice: double
  -buyoutPrice: double
  -bids: vector<shared_ptr<Bid>>
  -status: string
  -createdAt: string
  -completedAt: string
  +getId(): string
  +getPropertyId(): string
  +getStartingPrice(): double
  +getBuyoutPrice(): double
  +getStatus(): string
  +isActive(): bool
  +addBid(shared_ptr<Bid>): bool
  +getCurrentHighestBid(): double
  +complete(): void
  +toString(): string
  +toFileString(): string
}

class Bid {
  -clientId: string
  -clientName: string
  -amount: double
  -timestamp: string
  +getClientId(): string
  +getClientName(): string
  +getAmount(): double
  +getTimestamp(): string
  +toString(): string
  +toFileString(): string
}

' 4. Manager classes (4 classes)
class PropertyManager {
  -properties: vector<unique_ptr<Property>>
  +addProperty(unique_ptr<Property>): void
  +addApartment(ApartmentParams): void
  +addHouse(HouseParams): void
  +addCommercialProperty(CommercialPropertyParams): void
  +removeProperty(string): bool
  +findProperty(string): Property*
  +getAllProperties(): vector<Property*>
  +getAvailableProperties(): vector<Property*>
  +searchByPriceRange(double, double): vector<Property*>
  +searchByAddress(string, string, string): vector<Property*>
  +getCount(): size_t
}

class ClientManager {
  -clients: vector<shared_ptr<Client>>
  +addClient(shared_ptr<Client>): void
  +removeClient(string): bool
  +findClient(string): Client*
  +getAllClients(): vector<Client*>
  +searchByName(string): vector<Client*>
  +searchByPhone(string): vector<Client*>
  +getCount(): size_t
}

class TransactionManager {
  -transactions: vector<shared_ptr<Transaction>>
  +addTransaction(shared_ptr<Transaction>): void
  +removeTransaction(string): bool
  +findTransaction(string): Transaction*
  +getAllTransactions(): vector<Transaction*>
  +getTransactionsByClient(string): vector<Transaction*>
  +getTransactionsByProperty(string): vector<Transaction*>
  +getTransactionsByStatus(string): vector<Transaction*>
  +getCount(): size_t
}

class AuctionManager {
  -auctions: vector<shared_ptr<Auction>>
  +addAuction(shared_ptr<Auction>): void
  +removeAuction(string): bool
  +findAuction(string): Auction*
  +getAllAuctions(): vector<Auction*>
  +getActiveAuctions(): vector<Auction*>
  +getCompletedAuctions(): vector<Auction*>
  +getAuctionsByProperty(string): vector<Auction*>
  +getCount(): size_t
}

' 5. File Manager (1 class)
class FileManager {
  -{static} FILE_DELIMITER: char
  -{static} AVAILABLE_CHAR: char
  -{static} UNAVAILABLE_CHAR: char
  -{static} BID_PREFIX_LENGTH: size_t
  +{static} saveProperties(const PropertyManager&, string): void
  +{static} saveClients(const ClientManager&, string): void
  +{static} saveTransactions(const TransactionManager&, string): void
  +{static} saveAuctions(const AuctionManager&, string): void
  +{static} loadProperties(PropertyManager&, string): void
  +{static} loadClients(ClientManager&, string): void
  +{static} loadTransactions(TransactionManager&, string): void
  +{static} loadAuctions(AuctionManager&, string): void
}

' 6. Exception classes (5 classes)
class PropertyManagerException {
  -message: string
  +PropertyManagerException(string)
  +what(): const char*
}

class ClientManagerException {
  -message: string
  +ClientManagerException(string)
  +what(): const char*
}

class TransactionManagerException {
  -message: string
  +TransactionManagerException(string)
  +what(): const char*
}

class AuctionManagerException {
  -message: string
  +AuctionManagerException(string)
  +what(): const char*
}

class FileManagerException {
  -message: string
  +FileManagerException(string)
  +what(): const char*
}

' 7. Template class (1 class)
class ContainerManager<T> {
  #items: vector<shared_ptr<T>>
  +add(shared_ptr<T>): void
  +remove(string): void
  +findById(string): shared_ptr<T>
  +size(): size_t
  +begin(): const_iterator
  +end(): const_iterator
}

' 8. Singleton main class (1 class)
class EstateAgency {
  -{static} instance: EstateAgency*
  -propertyManager: PropertyManager
  -clientManager: ClientManager
  -transactionManager: TransactionManager
  -auctionManager: AuctionManager
  -dataDirectory: string
  -EstateAgency()
  +{static} getInstance(): EstateAgency*
  +{static} destroyInstance(): void
  +getPropertyManager(): PropertyManager&
  +getClientManager(): ClientManager&
  +getTransactionManager(): TransactionManager&
  +getAuctionManager(): AuctionManager&
  +saveAllData(): void
  +loadAllData(): void
  +setDataDirectory(string): void
  +getDataDirectory(): string
}

' 9. UI Classes (10+ classes)
class MainWindow {
  -agency: EstateAgency*
  -navigationList: QListWidget*
  -contentStack: QStackedWidget*
  -dashboardWidget: DashboardWidget*
  -propertiesWidget: PropertiesWidget*
  -clientsWidget: ClientsWidget*
  -transactionsWidget: TransactionsWidget*
  -auctionsWidget: AuctionsWidget*
  +MainWindow(QWidget*)
  -setupUI(): void
  -setupMenuBar(): void
  -applyStyles(): void
  -updateDashboardStats(): void
  -showStatusMessage(QString, int): void
  -handleException(exception&): void
}

class DashboardWidget {
  -agency: EstateAgency*
  -statsPropertiesLabel: QLabel*
  -statsClientsLabel: QLabel*
  -statsTransactionsLabel: QLabel*
  -statsAvailableLabel: QLabel*
  -statsAuctionsLabel: QLabel*
  -saveBtn: QPushButton*
  -loadBtn: QPushButton*
  -refreshBtn: QPushButton*
  +DashboardWidget(EstateAgency*, QWidget*)
  +updateStats(): void
}

class PropertiesWidget {
  -agency: EstateAgency*
  -propertiesTable: QTableWidget*
  -addPropertyBtn: QPushButton*
  -refreshPropertyBtn: QPushButton*
  -searchPropertyBtn: QPushButton*
  -searchPropertyEdit: QLineEdit*
  -propertyDetailsText: QTextEdit*
  +PropertiesWidget(EstateAgency*, QWidget*)
  +refresh(): void
  +updateTable(): void
  -addProperty(): void
  -editProperty(): void
  -deleteProperty(): void
  -searchProperties(): void
  -showPropertyDetails(Property*): void
}

class ClientsWidget {
  -agency: EstateAgency*
  -clientsTable: QTableWidget*
  -addClientBtn: QPushButton*
  -refreshClientBtn: QPushButton*
  -searchClientBtn: QPushButton*
  -searchClientEdit: QLineEdit*
  -clientDetailsText: QTextEdit*
  +ClientsWidget(EstateAgency*, QWidget*)
  +refresh(): void
  +updateTable(): void
  -showClientDetails(Client*): void
}

class TransactionsWidget {
  -agency: EstateAgency*
  -transactionsTable: QTableWidget*
  -addTransactionBtn: QPushButton*
  -refreshTransactionBtn: QPushButton*
  -searchTransactionBtn: QPushButton*
  -searchTransactionEdit: QLineEdit*
  -transactionDetailsText: QTextEdit*
  +TransactionsWidget(EstateAgency*, QWidget*)
  +refresh(): void
  +updateTable(): void
  -showTransactionDetails(Transaction*): void
  -validateTransaction(string, string, string, string): bool
}

class AuctionsWidget {
  -agency: EstateAgency*
  -auctionsTable: QTableWidget*
  -addAuctionBtn: QPushButton*
  -refreshAuctionBtn: QPushButton*
  -searchAuctionBtn: QPushButton*
  -searchAuctionEdit: QLineEdit*
  -auctionDetailsText: QTextEdit*
  +AuctionsWidget(EstateAgency*, QWidget*)
  +refresh(): void
  +updateTable(): void
  -showAuctionDetails(Auction*): void
  -hasActiveTransactions(string): bool
}

class PropertyDialog {
  -typeCombo: QComboBox*
  -idEdit: QLineEdit*
  -cityEdit: QLineEdit*
  -streetEdit: QLineEdit*
  -houseEdit: QLineEdit*
  -priceSpin: QDoubleSpinBox*
  -areaSpin: QDoubleSpinBox*
  -descriptionEdit: QTextEdit*
  -availableCheck: QCheckBox*
  +PropertyDialog(QWidget*, Property*)
  +getPropertyType(): PropertyType
  +getId(): QString
  +getCity(): QString
  +getStreet(): QString
  +getHouse(): QString
  +getPrice(): double
  +getArea(): double
  +getDescription(): QString
  +getIsAvailable(): bool
}

class ClientDialog {
  -idEdit: QLineEdit*
  -nameEdit: QLineEdit*
  -phoneEdit: QLineEdit*
  -emailEdit: QLineEdit*
  -buttonBox: QDialogButtonBox*
  +ClientDialog(QWidget*, Client*)
  +getId(): QString
  +getName(): QString
  +getPhone(): QString
  +getEmail(): QString
  -validateAndAccept(): void
}

class TransactionDialog {
  -idEdit: QLineEdit*
  -propertyCombo: QComboBox*
  -clientCombo: QComboBox*
  -priceSpin: QDoubleSpinBox*
  -statusCombo: QComboBox*
  -notesEdit: QTextEdit*
  -propertyPriceLabel: QLabel*
  -differenceLabel: QLabel*
  +TransactionDialog(QWidget*, Transaction*, QStringList, QStringList)
  +getId(): QString
  +getPropertyId(): QString
  +getClientId(): QString
  +getFinalPrice(): double
  +getStatus(): QString
  +getNotes(): QString
}

class AuctionDialog {
  -isViewMode: bool
  -currentAuction: Auction*
  -agency: EstateAgency*
  -idEdit: QLineEdit*
  -propertyCombo: QComboBox*
  -priceSpin: QDoubleSpinBox*
  -bidsTable: QTableWidget*
  -addBidBtn: QPushButton*
  -completeAuctionBtn: QPushButton*
  +AuctionDialog(QWidget*, Auction*, QStringList)
  +getId(): QString
  +getPropertyId(): QString
  +getStartingPrice(): double
  +refreshBids(): void
  +refreshAuctionInfo(): void
  -addBid(): void
  -completeAuction(): void
  -createTransactionFromAuction(): void
}

' === RELATIONSHIPS ===

' Structure composition
ApartmentParams *-- PropertyBaseParams
HouseParams *-- PropertyBaseParams
CommercialPropertyParams *-- PropertyBaseParams

' Structure usage
PropertyManager ..> ApartmentParams
PropertyManager ..> HouseParams
PropertyManager ..> CommercialPropertyParams

' Inheritance
Property <|-- Apartment
Property <|-- House
Property <|-- CommercialProperty

' Composition
Auction *-- Bid

' Core associations
Transaction --> Property
Transaction --> Client
Auction --> Property
Bid --> Client

' Manager composition
EstateAgency *-- PropertyManager
EstateAgency *-- ClientManager
EstateAgency *-- TransactionManager
EstateAgency *-- AuctionManager

PropertyManager o-- Property
ClientManager o-- Client
TransactionManager o-- Transaction
AuctionManager o-- Auction

' File manager usage
EstateAgency --> FileManager
FileManager --> PropertyManager
FileManager --> ClientManager
FileManager --> TransactionManager
FileManager --> AuctionManager

' Exception relationships
PropertyManager ..> PropertyManagerException
ClientManager ..> ClientManagerException
TransactionManager ..> TransactionManagerException
AuctionManager ..> AuctionManagerException
FileManager ..> FileManagerException

' UI composition
MainWindow *-- DashboardWidget
MainWindow *-- PropertiesWidget
MainWindow *-- ClientsWidget
MainWindow *-- TransactionsWidget
MainWindow *-- AuctionsWidget

' UI associations
MainWindow --> EstateAgency
PropertiesWidget --> EstateAgency
ClientsWidget --> EstateAgency
TransactionsWidget --> EstateAgency
AuctionsWidget --> EstateAgency
DashboardWidget --> EstateAgency
AuctionDialog --> EstateAgency

PropertyDialog --> Property
ClientDialog --> Client
TransactionDialog --> Transaction
AuctionDialog --> Auction

@enduml
