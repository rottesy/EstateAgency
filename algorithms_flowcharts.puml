' ============================================
' Блок-схемы алгоритмов выполнения ключевых функций
' Система управления агентством недвижимости
' ============================================

' 3.3.1 Алгоритм загрузки объектов недвижимости из файла
@startuml Алгоритм загрузки объектов недвижимости
!theme plain
skinparam activity {
  BackgroundColor #E8F4F8
  BorderColor #2E7D9A
  FontColor #1A4D6B
}
skinparam activityDiamond {
  BackgroundColor #FFF4E6
  BorderColor #D4A574
  FontColor #8B5A2B
}

start
:Создание вектора для хранения\nзагруженных объектов\nи открытие файла для чтения;
if (Файл не открыт?) then (да)
  stop
else (нет)
  :Очистка вектора объектов\nи чтение строки из файла;
  while (Файл не закончился?) is (нет)
    if (Строка пустая?) then (да)
      :Пропуск пустой строки;
    else (нет)
      :Извлечение типа объекта\nи парсинг полей\n(APARTMENT/HOUSE/COMMERCIAL);
      :Создание объекта соответствующего типа\nс распарсенными параметрами,\nустановка статуса доступности\nи добавление в вектор;
    endif
  endwhile (да)
  :Закрытие файла\nи передача загруженных объектов\nв менеджер через перемещение;
endif
stop
@enduml

' 3.3.2 Алгоритм загрузки аукционов из файла
@startuml Алгоритм загрузки аукционов
!theme plain
skinparam activity {
  BackgroundColor #E8F4F8
  BorderColor #2E7D9A
  FontColor #1A4D6B
}
skinparam activityDiamond {
  BackgroundColor #FFF4E6
  BorderColor #D4A574
  FontColor #8B5A2B
}

start
:Создание вектора для хранения\nзагруженных аукционов\nи открытие файла для чтения;
if (Файл не открыт?) then (да)
  stop
else (нет)
  :Инициализация указателя\nна текущий аукцион как nullptr\nи чтение строки из файла;
  while (Файл не закончился?) is (нет)
    if (Строка пустая?) then (да)
      :Пропуск пустой строки;
    else (нет)
      if (Строка начинается с "BID|"?) then (да)
        :Парсинг строки ставки\nи добавление ставки\nв текущий аукцион;
      else (нет)
        :Парсинг строки аукциона,\nсоздание объекта Auction,\nвосстановление статуса\nи добавление в вектор;
      endif
    endif
  endwhile (да)
  :Закрытие файла\nи передача загруженных аукционов\nв менеджер через перемещение;
endif
stop
@enduml

' 3.3.3 Алгоритм добавления ставки в аукцион
@startuml Алгоритм добавления ставки в аукцион
!theme plain
skinparam activity {
  BackgroundColor #E8F4F8
  BorderColor #2E7D9A
  FontColor #1A4D6B
}
skinparam activityDiamond {
  BackgroundColor #FFF4E6
  BorderColor #D4A574
  FontColor #8B5A2B
}

start
:Проверка статуса аукциона;
if (Статус == "active"?) then (нет)
  :Возврат false\n(ставка отклонена);
  stop
else (да)
  :Получение текущей максимальной\nставки в аукционе;
  if (Сумма ставки >= цена выкупа?) then (да)
    :Добавление ставки в список,\nзавершение аукциона\nи возврат true;
    stop
  else (нет)
    :Расчет минимальной допустимой ставки\n(текущая максимальная + 0.01\nили начальная цена);
    if (Сумма ставки < минимальной?) then (да)
      :Возврат false\n(ставка отклонена);
      stop
    else (нет)
      :Добавление ставки\nв список ставок аукциона\nи возврат true;
      stop
    endif
  endif
endif
@enduml

' 3.3.4 Алгоритм создания сделки из завершенного аукциона
@startuml Алгоритм создания сделки из аукциона
!theme plain
skinparam activity {
  BackgroundColor #E8F4F8
  BorderColor #2E7D9A
  FontColor #1A4D6B
}
skinparam activityDiamond {
  BackgroundColor #FFF4E6
  BorderColor #D4A574
  FontColor #8B5A2B
}

start
:Проверка наличия текущего\nаукциона и агентства;
if (Проверка пройдена?) then (нет)
  stop
else (да)
  :Получение победителя аукциона\n(ставка с максимальной суммой);
  if (Победитель найден?) then (нет)
    stop
  else (да)
    :Проверка наличия существующей сделки\nс теми же параметрами;
    if (Сделка существует?) then (да)
      stop
    else (нет)
      :Генерация базового идентификатора\nна основе текущего времени\nи нормализация до 6-8 символов;
      while (Идентификатор уже существует?) is (да)
        :Добавление числового суффикса\nк идентификатору\n(при необходимости - резервный ID);
      endwhile (нет)
      :Создание объекта Transaction\nс параметрами победителя,\nдобавление в менеджер сделок,\nполучение объекта недвижимости\nи установка статуса доступности\nв false (недоступен);
    endif
  endif
endif
stop
@enduml

' 3.3.5 Алгоритм поиска объектов недвижимости по адресу
@startuml Алгоритм поиска по адресу
!theme plain
skinparam activity {
  BackgroundColor #E8F4F8
  BorderColor #2E7D9A
  FontColor #1A4D6B
}
skinparam activityDiamond {
  BackgroundColor #FFF4E6
  BorderColor #D4A574
  FontColor #8B5A2B
}

start
:Создание вектора для хранения\nрезультатов поиска\nи нормализация входных параметров\n(город, улица, дом) в нижний регистр;
:Получение следующего объекта\nнедвижимости из коллекции;
while (Объект получен?) is (да)
  :Получение и нормализация\nадресных данных объекта\n(город, улица, дом) в нижний регистр;
  :Проверка совпадения по всем параметрам\n(город, улица, дом)\nс установкой флага совпадения;
  if (Флаг совпадения == true\nи хотя бы один параметр не пустой?) then (да)
    :Добавление объекта в результаты;
  endif
  :Получение следующего объекта\nнедвижимости из коллекции;
endwhile (нет)
:Возврат вектора результатов поиска;
stop
@enduml

' 3.3.6 Алгоритм добавления ставки через пользовательский интерфейс
@startuml Алгоритм добавления ставки через UI
!theme plain
skinparam activity {
  BackgroundColor #E8F4F8
  BorderColor #2E7D9A
  FontColor #1A4D6B
}
skinparam activityDiamond {
  BackgroundColor #FFF4E6
  BorderColor #D4A574
  FontColor #8B5A2B
}

start
:Проверка наличия текущего\nаукциона и режима просмотра;
if (Проверка пройдена?) then (нет)
  stop
else (да)
  :Проверка статуса аукциона\nи выбора клиента в комбобоксе;
  if (Аукцион активен\nи клиент выбран?) then (нет)
    :Отображение сообщения об ошибке;
    stop
  else (да)
    :Извлечение идентификатора клиента\nи поиск клиента в менеджере;
    if (Клиент найден?) then (нет)
      :Отображение сообщения об ошибке\n"Клиент не найден";
      stop
    else (да)
      :Получение суммы ставки из поля ввода,\nсоздание объекта Bid\nи попытка добавления ставки\nв аукцион через метод addBid();
      if (Ставка добавлена?) then (нет)
        :Расчет минимальной ставки,\nформирование сообщения об ошибке\nс подсказкой о выкупе\nи отображение пользователю;
        stop
      else (да)
        if (Сумма ставки >= цена выкупа?) then (да)
          :Вызов функции создания сделки\nи отображение сообщения\nо завершении аукциона;
        endif
        :Обновление таблицы ставок\nи информации об аукционе\nв интерфейсе;
        :Установка новой минимальной ставки\nв поле ввода;
        if (Аукцион больше не активен?) then (да)
          :Отключение элементов интерфейса\nдля добавления ставок;
        endif
      endif
    endif
  endif
endif
stop
@enduml
